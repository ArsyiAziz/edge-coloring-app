<!DOCTYPE >

<html>
  <head>
    <title>cytoscape-edgehandles.js demo</title>

    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1"
    />

    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
    <!-- for testing with local version of cytoscape.js -->
    <!--<script src="../cytoscape.js/build/cytoscape.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.js"></script>
    <script src="cytoscape-edgehandles.js"></script>

    <style>
      body {
        font-family: helvetica neue, helvetica, liberation sans, arial,
          sans-serif;
        font-size: 14px;
      }

      h1 {
        opacity: 0.5;
        font-size: 1em;
        font-weight: bold;
      }

      #buttons {
        position: absolute;
        right: 0;
        bottom: 0;
        z-index: 99999;
      }
    </style>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Inisialisasi objek cytoscape
        var cy = (window.cy = cytoscape({
          // container merujuk pada id dari element html untuk menampung hasil dari graph
          container: document.getElementById("cy"),

          // menonaktifkan fitur zoom dengan mouse wheel
          zoomingEnabled: false,

          // layout dari graph berbentuk circle
          layout: {
            name: "circle",
            animate: true,
            animationDuration: 500,
            animationEase: "ease-in-out",
            directed: false,
          },

          // style default
          style: [
            {
              selector: "node",
              style: {
                content: "data(id)",
                width: 30,
                height: 30,
                "text-valign": "center",
                "text-halign": "center",
              },
            },

            // some style for the extension

            {
              selector: ".eh-handle",
              style: {
                "background-color": "red",
                width: 12,
                height: 12,
                shape: "ellipse",
                "overlay-opacity": 0,
                "border-width": 12, // makes the handle easier to hit
                "border-opacity": 0,
                content: "",
              },
            },

            {
              selector: ".eh-hover",
              style: {
                "background-color": "red",
              },
            },

            {
              selector: ".eh-source",
              style: {
                "border-width": 2,
                "border-color": "red",
              },
            },

            {
              selector: ".eh-target",
              style: {
                "border-width": 2,
                "border-color": "red",
              },
            },

            {
              selector: ".eh-preview, .eh-ghost-edge",
              style: {
                "background-color": "red",
                "line-color": "red",
                "target-arrow-color": "red",
                "source-arrow-color": "red",
              },
            },

            {
              selector: ".eh-ghost-edge.eh-preview-active",
              style: {
                opacity: 0,
              },
            },
          ],

          // List elements default saat instansiasi objek cy
          elements: {
            nodes: [
              { data: { id: "e", name: "Elaine" } },
              { data: { id: "g", name: "George" } },
            ],
            edges: [{ data: { source: "g", target: "e" } }],
          },
        }));

        // Extension edge-handles berguna untuk membuat edge dengan fitur drag node
        var eh = cy.edgehandles();

        /*
        cy.on("ehcomplete", (event, sourceNode, targetNode, addedEles) => {
          console.log(cy.elements().jsons());
        });

        */

        // Menambahkan listener pada button add node
        let btnAddNode = document.getElementById("btn-add-node");
        btnAddNode.addEventListener("click", function (e) {
          let nodeName = document.getElementById("node-name");
          if (nodeName.value !== "") {
            // Menambah node ke elements pada objek cytoscape
            cy.add({
              group: "nodes",
              data: {
                id: nodeName.value,
              },
            });

            // Merender ulang perubahan pada elements
            cy.layout({
              name: "circle",
              animate: true,
              animationDuration: 500,
              animationEase: "ease-in-out",
              directed: false,
            }).run();
          }
        });
      });
    </script>
  </head>

  <body class="box-border py-5">
    <div class="w-5/6 mx-auto flex h-full">
      <div id="cy" class="flex-1 h-full border-4 border-black rounded-xl"></div>
      <div class="flex-1 p-5">
        <div>
          <input
            id="node-name"
            type="text"
            class="border-2 border-gray-400 h-11 rounded-md px-2"
            placeholder="Insert Node"
          />
          <button
            id="btn-add-node"
            class="bg-purple-500 h-11 w-20 rounded-md text-white font-bold"
          >
            ADD
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
